# Telegram Attendance Bot

## –ü—Ä–æ –±–æ—Ç–∞

Telegram –±–æ—Ç –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –Ω–∞–¥—Å–∏–ª–∞—î —â–æ–¥–µ–Ω–Ω—ñ –∑–≤—ñ—Ç–∏ –æ 10:00 –∑–∞ –í–∞—Ä—à–∞–≤—Å—å–∫–∏–º —á–∞—Å–æ–º –∑ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è —Ç–∞ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ.

## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —â–æ–¥–µ–Ω–Ω—ñ –∑–≤—ñ—Ç–∏ –æ 10:00 (–í–∞—Ä—à–∞–≤–∞)
- üìä –ó–∞–ø–∏—Ç –∑–≤—ñ—Ç—É –≤—Ä—É—á–Ω—É –∫–æ–º–∞–Ω–¥–æ—é `/report_today`
- üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
- ‚è∞ –ü–µ—Ä—ñ–æ–¥ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—ñ: 15 —Ö–≤–∏–ª–∏–Ω
- üèñÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∫–ª—é—á–µ–Ω–Ω—è —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤ —É –≤—ñ–¥–ø—É—Å—Ç—Ü—ñ (—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ PeopleForce)
- üåç –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä—ñ–∑–Ω–∏—Ö —á–∞—Å–æ–≤–∏—Ö –ø–æ—è—Å—ñ–≤ (–ª–æ–∫–∞–ª—å–Ω–∏–π —á–∞—Å –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è

–î–æ–¥–∞–π—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
TELEGRAM_ADMIN_CHAT_IDS=123456789,987654321

# YaWare API (–ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –≤–∂–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ)
YAWARE_ACCESS_KEY=your_key

# PeopleForce API (–ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –≤–∂–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ)
PEOPLEFORCE_API_KEY=your_key
```

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞:**

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –ù–∞–¥—ñ—à–ª—ñ—Ç—å `/newbot`
3. –í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ username –±–æ—Ç–∞
4. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ç–æ–∫–µ–Ω —É —Ñ–æ—Ä–º–∞—Ç `TELEGRAM_BOT_TOKEN`

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è Chat ID:**

1. –î–æ–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø—É –∞–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å –π–æ–º—É –æ—Å–æ–±–∏—Å—Ç–æ
2. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
3. –ó–Ω–∞–π–¥—ñ—Ç—å `"chat":{"id":123456789}` - —Ü–µ –≤–∞—à Chat ID

### 2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–ù–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:

- `python-telegram-bot>=20.0` - Telegram bot framework
- `pytz` - Timezone handling
- `APScheduler` - Task scheduling

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python scripts/run_attendance_bot.py
```

–ê–±–æ –∑ –∫–æ—Ä–µ–Ω—è –ø—Ä–æ—î–∫—Ç—É:

```bash
python -m tracker_alert.bot.telegram_bot
```

## –ö–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞

- `/start` - –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è —Ç–∞ –æ–≥–ª—è–¥ –∫–æ–º–∞–Ω–¥
- `/help` - –î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞ –ø–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—é
- `/status` - –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- `/report_today` - –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–≤—ñ—Ç –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –≤—Ä—É—á–Ω—É

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
tracker_alert/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot.py          # –û—Å–Ω–æ–≤–Ω–∏–π –∫–ª–∞—Å AttendanceBot
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.py              # –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ —â–æ–¥–µ–Ω–Ω–∏—Ö –∑–≤—ñ—Ç—ñ–≤
‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ       ‚îî‚îÄ‚îÄ commands.py           # –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ attendance_monitor.py    # –õ–æ–≥—ñ–∫–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ
‚îÇ   ‚îî‚îÄ‚îÄ report_formatter.py      # –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∑–≤—ñ—Ç—ñ–≤ –¥–ª—è Telegram
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ settings.py               # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–≤–∫–ª—é—á–∞—î Telegram config)

scripts/
‚îî‚îÄ‚îÄ run_attendance_bot.py        # Entry point –¥–ª—è –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞
```

## –§–æ—Ä–º–∞—Ç –∑–≤—ñ—Ç—É

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —â–æ–¥–µ–Ω–Ω–æ–≥–æ –∑–≤—ñ—Ç—É:**

```
‚ö†Ô∏è Attendance Report - 2024-01-15

üë§ Late (3):
‚Ä¢ Ivanov Ivan - Arrived at 09:20 (20 min late)
‚Ä¢ Petrov Petr - Arrived at 09:45 (45 min late)
‚Ä¢ Sidorov Sidor - Arrived at 10:30 (90 min late)

‚ùå Absent (1):
‚Ä¢ Kuznetsov Igor - No check-in data
```

**–Ø–∫—â–æ –≤—Å—ñ –≤—á–∞—Å–Ω–æ:**

```
‚úÖ Attendance Report - 2024-01-15

üéâ All employees are on time! No issues to report.
```

## –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏

1. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∞—Å—É:**

   - –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è `time_start` –∑ YaWare API –∑ `start_time` –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
   - –û–±–∏–¥–≤–∞ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–±–µ–∑ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó)
   - –ü–µ—Ä—ñ–æ–¥ —Ç–æ–ª–µ—Ä–∞–Ω—Ç–Ω–æ—Å—Ç—ñ: 15 —Ö–≤–∏–ª–∏–Ω

2. **–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó:**

   - **Late**: –ü—Ä–∏–π—à–æ–≤ –ø—ñ–∑–Ω—ñ—à–µ –Ω—ñ–∂ `start_time + 15 —Ö–≤–∏–ª–∏–Ω`
   - **Absent**: –ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –≤ YaWare API
   - **On-time**: –ù–µ –≤–∫–ª—é—á–∞—î—Ç—å—Å—è –≤ –∑–≤—ñ—Ç

3. **–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è:**
   - –í–∏–∫–ª—é—á–µ–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ (`"exclude_from_reports": true`)
   - –ù—ñ—á–Ω—ñ –∑–º—ñ–Ω–∏ (`"note": "–ù—ñ—á–Ω–∞ –∑–º—ñ–Ω–∞"`)
   - –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∏ —É –≤—ñ–¥–ø—É—Å—Ç—Ü—ñ (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–µ—Ä–µ–∑ PeopleForce API)

## –ë–µ–∑–ø–µ–∫–∞

- üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è chat_id –∑—ñ —Å–ø–∏—Å–∫—É `TELEGRAM_ADMIN_CHAT_IDS`
- üö´ –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å "Access denied"
- üìù –í—Å—ñ —Å–ø—Ä–æ–±–∏ –¥–æ—Å—Ç—É–ø—É –ª–æ–≥—É—é—Ç—å—Å—è

**Dev —Ä–µ–∂–∏–º:** –Ø–∫—â–æ `TELEGRAM_ADMIN_CHAT_IDS` –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ, –±–æ—Ç –¥–æ–∑–≤–æ–ª—è—î –≤—Å—ñ–º (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏!)

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

–í—Å—ñ –ø–æ–¥—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è:

- –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–≤—ñ—Ç—ñ–≤ (—É—Å–ø—ñ—Ö/–ø–æ–º–∏–ª–∫–∞)
- –í–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥
- –°–ø—Ä–æ–±–∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
- –ü–æ–º–∏–ª–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–≤—ñ—Ç—ñ–≤

–§–æ—Ä–º–∞—Ç: `%(asctime)s - %(name)s - %(levelname)s - %(message)s`

## Troubleshooting

**–ë–æ—Ç –Ω–µ —Å—Ç–∞—Ä—Ç—É—î:**

- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `TELEGRAM_BOT_TOKEN` –≤ `.env`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —á–µ—Ä–µ–∑ [@BotFather](https://t.me/botfather)

**–ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –∑–≤—ñ—Ç–∏:**

- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `TELEGRAM_ADMIN_CHAT_IDS` - –ø—Ä–∞–≤–∏–ª—å–Ω—ñ Chat ID?
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ –Ω–∞ –ø–æ–º–∏–ª–∫–∏ –≤ `send_daily_report()`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ –±–æ—Ç –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ YaWare —Ç–∞ PeopleForce API

**"Access denied":**

- –î–æ–¥–∞–π—Ç–µ –≤–∞—à Chat ID –≤ `TELEGRAM_ADMIN_CHAT_IDS` (—á–µ—Ä–µ–∑ –∫–æ–º—É)
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞ –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ `.env`

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —á–∞—Å –∑–≤—ñ—Ç—ñ–≤:**

- –ó–≤—ñ—Ç–∏ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –æ 10:00 **–í–∞—Ä—à–∞–≤—Å—å–∫–æ–≥–æ —á–∞—Å—É**
- –ß–∞—Å –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –≤ `AttendanceScheduler.REPORT_TIME`
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ timezone —Å–µ—Ä–≤–µ—Ä–∞: `date` (Linux/Mac) –∞–±–æ `Get-Date` (Windows)

## –†–æ–∑—Ä–æ–±–∫–∞

**–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—Ä—É—á–Ω—É:**

```bash
# –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–≤—ñ—Ç –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
/report_today

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
/status
```

**–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —á–∞—Å—É –∑–≤—ñ—Ç—ñ–≤:**
–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ –≤ `tracker_alert/bot/scheduler.py`:

```python
REPORT_TIME = time(10, 0)  # –ì–æ–¥–∏–Ω–∞, —Ö–≤–∏–ª–∏–Ω–∞
REPORT_TIMEZONE = "Europe/Warsaw"
```

**–î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –∫–æ–º–∞–Ω–¥:**

1. –î–æ–¥–∞–π—Ç–µ handler –≤ `bot/handlers/commands.py`
2. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ –≤ `AttendanceBot.build_application()`

## –ê–≤—Ç–æ—Ä

YaWare Bot Project - Attendance Monitoring System
