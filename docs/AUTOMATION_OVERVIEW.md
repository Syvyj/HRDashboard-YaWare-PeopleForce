# ‚öôÔ∏è –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–Ω—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π

–¶–µ–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—É—î, —è–∫ –≤–∑–∞—î–º–æ–¥—ñ—é—Ç—å Telegram‚Äë–±–æ—Ç, –≤–µ–±‚Äë–¥–∞—à–±–æ—Ä–¥, PeopleForce —Ç–∞ Google Sheets. –í—ñ–Ω –¥–æ–ø–æ–º–∞–≥–∞—î —à–≤–∏–¥–∫–æ –∑–æ—Ä—ñ—î–Ω—Ç—É–≤–∞—Ç–∏—Å—è, –¥–µ –∑–Ω–∞—Ö–æ–¥—è—Ç—å—Å—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, —Ä–æ–∑–∫–ª–∞–¥–∏ —Ç–∞ —â–æ —î ¬´–¥–∂–µ—Ä–µ–ª–æ–º –ø—Ä–∞–≤–¥–∏¬ª –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–∏–ø—É –¥–∞–Ω–∏—Ö.

## ü§ñ –†—ñ–≤–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –©–æ —Ä–æ–±–∏—Ç—å | –ì–æ–ª–æ–≤–Ω—ñ —Ñ–∞–π–ª–∏ |
| --- | --- | --- |
| **Telegram Attendance Bot** | –†—É—á–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ (`/report_today`, `/status`), –∞–¥–º—ñ–Ω—Å—å–∫—ñ CRUD-–¥—ñ–∞–ª–æ–≥–∏, –ø—É—à—ñ –ø—Ä–æ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è —Ç–∞ —Ä–∞–Ω–∫–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. | `tracker_alert/bot/telegram_bot.py`, `tracker_alert/bot/scheduler.py`, `scripts/run_attendance_bot.py`, `docs/TELEGRAM_BOT_GUIDE.md` |
| **Scheduler –±–æ—Ç–∞** | –©–æ–¥–µ–Ω–Ω—ñ Telegram-–∑–≤—ñ—Ç–∏ —Ç–∞ —Ä–∞–Ω–∫–æ–≤–µ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –Ω–∞ —Å–∞–π—Ç. | `tracker_alert/bot/scheduler.py`, `docs/AUTO_EXPORT_GUIDE.md` |
| **Scheduler –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∞** | –°–∏–Ω–∫ –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ –∑ YaWare + –æ–Ω–æ–≤–ª–µ–Ω–Ω—è PeopleForce-—Å—Ç–∞—Ç—É—Å—ñ–≤ (–≤—ñ–¥–ø—É—Å—Ç–∫–∞/–ª—ñ–∫–∞—Ä–Ω—è–Ω–∏–π). | `dashboard_app/tasks.py`, `tasks/update_attendance.py` |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è** | README + —Ü–µ–π —Ñ–∞–π–ª ‚Üí –∑–∞–≥–∞–ª—å–Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∞; —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω—ñ –≥—ñ–¥–∏ –ø–æ—è—Å–Ω—é—é—Ç—å –¥–µ—Ç–∞–ª—ñ (Telegram, PeopleForce, –µ–∫—Å–ø–æ—Ä—Ç). | `README.md`, `docs/*.md` |

## üïí –†–æ–∑–∫–ª–∞–¥ –∑–∞–¥–∞—á —Ç–∞ —á–∞—Å–æ–≤—ñ –ø–æ—è—Å–∏

| –ß–∞—Å Warsaw | –î–Ω—ñ | –ó–∞–≤–¥–∞–Ω–Ω—è | –í—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç |
| --- | --- | --- | --- |
| 09:00 | –ü–Ω‚Äë–ü—Ç | Telegram-–Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –∑ –∫–Ω–æ–ø–∫–æ—é ‚Äú–í—ñ–¥–∫—Ä–∏—Ç–∏ —Å–∞–π—Ç‚Äù. | `AttendanceScheduler.send_morning_message` |
| 09:15 | –©–æ–¥–Ω—è | –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –≤—á–æ—Ä–∞—à–Ω—ñ—Ö –¥–∞–Ω–∏—Ö YaWare ‚Üí `attendance_records`. | `_run_daily_attendance` (`dashboard_app/tasks.py`) |
| 09:17 | –©–æ–¥–Ω—è | –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ PeopleForce (–≤—ñ–¥–ø—É—Å—Ç–∫–∞/–ª—ñ–∫–∞—Ä–Ω—è–Ω–∏–π) —É `user_schedules.json`. | `_sync_peopleforce_metadata` |
| 09:20 | –ü–Ω‚Äë–ü—Ç | –¢–µ–ª–µ–≥—Ä–∞–º-–∑–≤—ñ—Ç –ø—Ä–æ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è (–¥–∞–Ω—ñ –∑ –ë–î). | `AttendanceScheduler.send_daily_report` |

> **–ü—Ä–∏–º—ñ—Ç–∫–∞:** —É—Å—ñ Cron-–∑–∞–¥–∞—á—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å —á–∞—Å–æ–≤—É –∑–æ–Ω—É Europe/Warsaw, —Ç–æ–º—É –ø–µ—Ä–µ—Ö–æ–¥–∏ –Ω–∞ –ª—ñ—Ç–Ω—ñ–π/–∑–∏–º–æ–≤–∏–π —á–∞—Å –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ.

## üóÇÔ∏è –î–∂–µ—Ä–µ–ª–∞ –¥–∞–Ω–∏—Ö —Ç–∞ –≤–ª–∞—Å–Ω–∏–∫–∏

| –î–∞–Ω—ñ | –î–∂–µ—Ä–µ–ª–æ –ø—Ä–∞–≤–¥–∏ | –û–Ω–æ–≤–ª—é—î | –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ |
| --- | --- | --- | --- |
| API –∫–ª—é—á—ñ, ID —Ç–∞–±–ª–∏—Ü—å, —á–∞—Ç—ñ–≤ | `.env` / `tracker_alert/config/settings.py` | DevOps (—Å–µ–∫—Ä–µ—Ç–∏), –≤–ª–∞—Å–Ω–∏–∫–∏ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ–π | –Ñ–¥–∏–Ω–µ –º—ñ—Å—Ü–µ –¥–ª—è YAWARE/PeopleForce/Sheets/Telegram —Ç–æ–∫–µ–Ω—ñ–≤. |
| –ì—Ä–∞—Ñ—ñ–∫–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, manual overrides | `config/user_schedules.json` | –ê–¥–º—ñ–Ω–∏ (—Ä—É—á–Ω—ñ –ø—Ä–∞–≤–∫–∏), PeopleForce-—Å–∏–Ω–∫ | –ê–≤—Ç–æ—Å–∏–Ω–∫ –∑–º—ñ–Ω—é—î –ª–∏—à–µ –ø–æ–ª—è –±–µ–∑ manual-—Ñ–ª–∞–≥—ñ–≤. |
| –ö–æ–Ω—Ç—Ä–æ–ª—å‚Äë–º–µ–Ω–µ–¥–∂–µ—Ä–∏ | `user_schedules.json` (`control_manager`), –¥–æ–≤—ñ–¥–Ω–∏–∫ —É PeopleForce | Scheduler —Ç–∞ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∏ | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä—ñ–≤ —É –¥–∞—à–±–æ—Ä–¥—ñ —Ç–∞ —á–∞—Å—Ç–∫–æ–≤–∏—Ö Telegram-–∑–≤—ñ—Ç—ñ–≤. |
| –í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å & –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å | YaWare API v2 | Scheduler (–¥–∞—à–±–æ—Ä–¥/–±–æ—Ç), —Ä—É—á–Ω—ñ CLI (`tasks/update_attendance.py`) | –ü—ñ—Å–ª—è —ñ–º–ø–æ—Ä—Ç—É –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É SQLite (`instance/dashboard.db`). |
| –í—ñ–¥–ø—É—Å—Ç–∫–∏/–ª—ñ–∫–∞—Ä–Ω—è–Ω—ñ —Å—Ç–∞—Ç—É—Å–∏ | PeopleForce API | `_sync_peopleforce_metadata`, `scripts/sync_peopleforce_telegram.py` | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–æ—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ leave status —Ç–∞ —Å—É–º–∞ –¥–Ω—è. |
| Google Sheets | `tracker_alert/services/sheets.py` + `gcp-sa.json` | Scheduler, —Ä—É—á–Ω—ñ –∑–∞–ø—É—Å–∫–∏ –µ–∫—Å–ø–æ—Ä—Ç—É | –¢–∞–±–ª–∏—Ü—ñ –ø–æ–¥—ñ–ª—è—é—Ç—å—Å—è –º—ñ–∂ –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ (–¥–∏–≤. –Ω–∏–∂—á–µ). |

## üë• –ú–∞–ø—ñ–Ω–≥ –∫–æ–Ω—Ç—Ä–æ–ª—å‚Äë–º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤ —Ç–∞ Google Sheets

| ID –º–µ–Ω–µ–¥–∂–µ—Ä–∞ | –©–æ –æ–∑–Ω–∞—á–∞—î | –î–æ—Å—Ç—É–ø —É Telegram | –¢–∞–±–ª–∏—Ü—è Google Sheets |
| --- | --- | --- | --- |
| `1` | –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ –≥—Ä—É–ø–∞ #1 (Apps/Control 1) | –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `TELEGRAM_MANAGER_MAPPING` (`chat_id:1`). | `SPREADSHEET_ID_CONTROL_1` |
| `2` | –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞ –≥—Ä—É–ø–∞ #2 | `TELEGRAM_MANAGER_MAPPING` (`chat_id:2`). | `SPREADSHEET_ID_CONTROL_2` |
| ‚Äî | –ü–æ–≤–Ω–∏–π –¥–æ—Å—Ç—É–ø (–≤—Å—ñ –º–µ–Ω–µ–¥–∂–µ—Ä–∏) | –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –º–∞–ø—ñ–Ω–≥—É –∞–±–æ –∫—ñ–ª—å–∫–∞ ID | `SPREADSHEET_ID` (–æ—Å–Ω–æ–≤–Ω–∞ —Ç–∞–±–ª–∏—Ü—è) |

**–î–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è:**

- `AttendanceScheduler` —Ñ—ñ–ª—å—Ç—Ä—É—î –∑–≤—ñ—Ç —ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ, —Å–ø–∏—Ä–∞—é—á–∏—Å—å –Ω–∞ `AttendanceBot.get_allowed_managers`.
- –£ –≤–µ–±-–¥–∞—à–±–æ—Ä–¥—ñ control manager –≤–∏–∑–Ω–∞—á–∞—î, —è–∫—ñ –¥–∞–Ω—ñ –±–∞—á–∏—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, —ñ —á–∏ –Ω–∞–ª–µ–∂–∏—Ç—å –∑–∞–ø–∏—Å –¥–æ –ø–µ–≤–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞.
- PeopleForce-—Å–∏–Ω–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ø—ñ–ª—å–Ω—É —É—Ç–∏–ª—ñ—Ç—É `tracker_alert.services.control_manager.auto_assign_control_manager`.

## üõ†Ô∏è –®–ø–∞—Ä–≥–∞–ª–∫–∞ –∑–∞–ø—É—Å–∫—ñ–≤ (CLI + Cron)

### CLI-–∫–æ–º–∞–Ω–¥–∏

- **–ó–∞–ø—É—Å–∫ Telegram-–±–æ—Ç–∞ + scheduler:** `python scripts/run_attendance_bot.py`
- **–°—Ç–≤–æ—Ä–∏—Ç–∏/–æ–Ω–æ–≤–∏—Ç–∏ —Ç–∏–∂–Ω–µ–≤–∏–π –∞—Ä–∫—É—à:** `python3 -m tracker_alert.scripts.export_weekly [YYYY-MM-DD]`
- **–î–æ–¥–∞—Ç–∏ –≤—á–æ—Ä–∞—à–Ω—ñ–π –¥–µ–Ω—å —É –ø–æ—Ç–æ—á–Ω–∏–π –∞—Ä–∫—É—à:** `python3 -m tracker_alert.scripts.update_yesterday`
- **–†—É—á–Ω–∏–π —Å–∏–Ω–∫ PeopleForce ‚Üí user_schedules.json:** `python3 scripts/sync_peopleforce_telegram.py`
- **–Ü–º–ø–æ—Ä—Ç –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ –≤ –¥–∞—à–±–æ—Ä–¥:** `python3 tasks/update_attendance.py --date 2025-01-15` (–∞–±–æ –∑ –¥—ñ–∞–ø–∞–∑–æ–Ω–æ–º `--start-date/--end-date`)

–ö–æ–º–∞–Ω–¥–∏ –º–æ–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç–∏ –∑ –∫–æ—Ä–µ–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é; –∑–∞ –ø–æ—Ç—Ä–µ–±–∏ –¥–æ–¥–∞–π—Ç–µ `PYTHONPATH` —á–∏ `.env`.

### –ü—Ä–∏–∫–ª–∞–¥–∏ cron

```cron
# –û 09:00 —â–æ–¥–Ω—è –¥–æ–¥–∞–≤–∞—Ç–∏ –≤—á–æ—Ä–∞—à–Ω—ñ–π –¥–µ–Ω—å (update_yesterday)
0 9 * * * cd /opt/YaWare_Bot && /usr/bin/python3 -m tracker_alert.scripts.update_yesterday >> /var/log/yaware/update.log 2>&1

# –û 08:00 —â–æ–ø–æ–Ω–µ–¥—ñ–ª–∫–∞ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –Ω–æ–≤–∏–π —Ç–∏–∂–¥–µ–Ω—å (export_weekly)
0 8 * * 1 cd /opt/YaWare_Bot && /usr/bin/python3 -m tracker_alert.scripts.export_weekly >> /var/log/yaware/export.log 2>&1
```

### –ü—Ä–∏–∫–ª–∞–¥ systemd timer (—â–æ–¥–µ–Ω–Ω–∏–π update_yesterday)

`/etc/systemd/system/yaware-update.service`

```ini
[Unit]
Description=YaWare Daily Update
After=network.target

[Service]
Type=oneshot
User=deploy
WorkingDirectory=/opt/YaWare_Bot
ExecStart=/usr/bin/python3 -m tracker_alert.scripts.update_yesterday
StandardOutput=journal
StandardError=journal
```

`/etc/systemd/system/yaware-update.timer`

```ini
[Unit]
Description=YaWare Daily Update Timer
Requires=yaware-update.service

[Timer]
OnCalendar=*-*-* 09:00:00
Persistent=true

[Install]
WantedBy=timers.target
```

–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏:

```bash
sudo systemctl daemon-reload
sudo systemctl enable --now yaware-update.timer
```

## üìö –Ø–∫ —á–∏—Ç–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é

1. **–ü—Ä–∞–≥–Ω–µ—Ç–µ —à–≤–∏–¥–∫–æ –∑–≥–∞–¥–∞—Ç–∏ —Ä–æ–∑–∫–ª–∞–¥/—ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—ó?** ‚Äî —á–∏—Ç–∞—Ç–∏ —Ü–µ–π —Ñ–∞–π–ª.
2. **–ü–æ—Ç—Ä—ñ–±–Ω—ñ –¥–µ—Ç–∞–ª—ñ –ø—Ä–æ Telegram-–∫–æ–º–∞–Ω–¥–∏, –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞ —á–∏ troubleshooting?** ‚Äî `docs/TELEGRAM_BOT_GUIDE.md`.
3. **–ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç–µ PeopleForce ‚Üí Telegram/–º–µ–Ω–µ–¥–∂–µ—Ä—ñ–≤?** ‚Äî `docs/PEOPLEFORCE_API_GUIDE.md`.
4. **–•–æ—á–µ—Ç–µ –∑—Ä–æ–∑—É–º—ñ—Ç–∏ –µ–∫—Å–ø–æ—Ä—Ç —É Sheets –∞–±–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≤—Ä—É—á–Ω—É?** ‚Äî `docs/AUTO_EXPORT_GUIDE.md`.
5. **–®—É–∫–∞—î—Ç–µ –∑–∞–≥–∞–ª—å–Ω–µ –±–∞—á–µ–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—É —Ç–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥/–±–µ–∫–µ–Ω–¥?** ‚Äî `README.md` + `docs/PROJECT_STRUCTURE.md`.

–¶–µ–π –æ–≥–ª—è–¥ –¥–æ–ø–æ–º–æ–∂–µ —É–Ω–∏–∫–Ω—É—Ç–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –º—ñ–∂ —Ñ–∞–π–ª–∞–º–∏. –Ø–∫—â–æ –≤ —ñ–Ω—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –æ–ø–∏—Å–∞–Ω–æ —Ä–æ–∑–∫–ª–∞–¥ –∞–±–æ –º–∞–ø—ñ–Ω–≥, –ø–æ—Å–∏–ª–∞–π—Ç–µ—Å—è –Ω–∞ —Ç–∞–±–ª–∏—Ü—ñ –≤–∏—â–µ.
