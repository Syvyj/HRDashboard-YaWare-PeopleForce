# Telegram Attendance Bot

## –ü—Ä–æ –±–æ—Ç–∞

Telegram –±–æ—Ç –¥–ª—è –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤. –©–æ—Ä–∞–Ω–∫—É –æ **09:20 (Warsaw)** –≤—ñ–Ω –¥—ñ—Å—Ç–∞—î –¥–∞–Ω—ñ –∑ –±–∞–∑–∏ `attendance_records` —ñ –Ω–∞–¥—Å–∏–ª–∞—î –∞–¥–º—ñ–Ω–∞–º –∑–≤—ñ—Ç –ø—Ä–æ –∑–∞–ø—ñ–∑–Ω–µ–Ω–Ω—è/–≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ. –£–∑–∞–≥–∞–ª—å–Ω–µ–Ω–∏–π —Ä–æ–∑–∫–ª–∞–¥ —É—Å—ñ—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ–π –¥–∏–≤. —É `docs/AUTOMATION_OVERVIEW.md`.

## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —â–æ–¥–µ–Ω–Ω–∏–π –∑–≤—ñ—Ç –æ 09:20 (Warsaw) –∑ –¥–∞–Ω–∏—Ö –¥–∞—à–±–æ—Ä–¥—É
- üîÅ –ö–æ–º–∞–Ω–¥–∞ `/report_today` –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ—ó –≤—ñ–¥–ø—Ä–∞–≤–∫–∏
- üîó –®–≤–∏–¥–∫–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å–∞–π—Ç –∑ –¥–µ—Ç–∞–ª—å–Ω–æ—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ—é
- üîê –î–æ—Å—Ç—É–ø –ª–∏—à–µ –¥–ª—è chat_id –∑ `TELEGRAM_ADMIN_CHAT_IDS`

## –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –ó–º—ñ–Ω–Ω—ñ –æ—Ç–æ—á–µ–Ω–Ω—è

–î–æ–¥–∞–π—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token_from_botfather
TELEGRAM_ADMIN_CHAT_IDS=123456789,987654321

# (–æ–ø—Ü—ñ–π–Ω–æ) –®–ª—è—Ö –¥–æ –ë–î –¥–∞—à–±–æ—Ä–¥—É
DASHBOARD_DATABASE_URL=sqlite:///dashboard.db
```

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞:**

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ [@BotFather](https://t.me/botfather) –≤ Telegram
2. –ù–∞–¥—ñ—à–ª—ñ—Ç—å `/newbot`
3. –í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É —Ç–∞ username –±–æ—Ç–∞
4. –°–∫–æ–ø—ñ—é–π—Ç–µ —Ç–æ–∫–µ–Ω —É —Ñ–æ—Ä–º–∞—Ç `TELEGRAM_BOT_TOKEN`

**–û—Ç—Ä–∏–º–∞–Ω–Ω—è Chat ID:**

1. –î–æ–¥–∞–π—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø—É –∞–±–æ –Ω–∞–ø–∏—à—ñ—Ç—å –π–æ–º—É –æ—Å–æ–±–∏—Å—Ç–æ
2. –í—ñ–¥–∫—Ä–∏–π—Ç–µ `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
3. –ó–Ω–∞–π–¥—ñ—Ç—å `"chat":{"id":123456789}` - —Ü–µ –≤–∞—à Chat ID

### 2. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–ù–æ–≤—ñ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ:

- `python-telegram-bot>=20.0` - Telegram bot framework
- `pytz` - Timezone handling
- `APScheduler` - Task scheduling

### 3. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python scripts/run_attendance_bot.py
```

–ê–±–æ –∑ –∫–æ—Ä–µ–Ω—è –ø—Ä–æ—î–∫—Ç—É:

```bash
python -m tracker_alert.bot.telegram_bot
```

## –ö–æ–º–∞–Ω–¥–∏ –±–æ—Ç–∞

- `/start` - –ü—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è —Ç–∞ –æ–≥–ª—è–¥ –∫–æ–º–∞–Ω–¥
- `/help` - –î–µ—Ç–∞–ª—å–Ω–∞ –¥–æ–≤—ñ–¥–∫–∞ –ø–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—é
- `/status` - –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ —Ç–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è
- `/report_today` - –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–≤—ñ—Ç –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ –≤—Ä—É—á–Ω—É

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```
tracker_alert/
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ telegram_bot.py          # –û—Å–Ω–æ–≤–Ω–∏–π –∫–ª–∞—Å AttendanceBot
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.py             # –ü–ª–∞–Ω—É–≤–∞–ª—å–Ω–∏–∫ –∑–≤—ñ—Ç—ñ–≤ / –Ω–∞–≥–∞–¥—É–≤–∞–Ω—å
‚îÇ   ‚îî‚îÄ‚îÄ handlers/
‚îÇ       ‚îî‚îÄ‚îÄ commands.py           # –û–±—Ä–æ–±–Ω–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ dashboard_report.py      # –ß–∏—Ç–∞–Ω–Ω—è attendance_records –∑ –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ report_formatter.py      # –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∑–≤—ñ—Ç—ñ–≤ –¥–ª—è Telegram
‚îî‚îÄ‚îÄ config/
    ‚îî‚îÄ‚îÄ settings.py               # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–≤–∫–ª—é—á–∞—î Telegram config)

scripts/
‚îî‚îÄ‚îÄ run_attendance_bot.py        # Entry point –¥–ª—è –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞
```

## –§–æ—Ä–º–∞—Ç –∑–≤—ñ—Ç—É

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —â–æ–¥–µ–Ω–Ω–æ–≥–æ –∑–≤—ñ—Ç—É:**

```
‚ö†Ô∏è Attendance Report - 2024-01-15

üë§ Late (3):
‚Ä¢ Ivanov Ivan - Arrived at 09:20 (20 min late)
‚Ä¢ Petrov Petr - Arrived at 09:45 (45 min late)
‚Ä¢ Sidorov Sidor - Arrived at 10:30 (90 min late)

‚ùå Absent (1):
‚Ä¢ Kuznetsov Igor - No check-in data
```

**–Ø–∫—â–æ –≤—Å—ñ –≤—á–∞—Å–Ω–æ:**

```
‚úÖ Attendance Report - 2024-01-15

üéâ All employees are on time! No issues to report.
```

## –õ–æ–≥—ñ–∫–∞ —Ä–æ–±–æ—Ç–∏

1. **–î–∂–µ—Ä–µ–ª–æ –¥–∞–Ω–∏—Ö:** —Ç–∞–±–ª–∏—Ü—è `attendance_records` (–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –±–µ–∫–≥—Ä–∞—É–Ω–¥ –∑–∞–¥–∞—á–∞–º–∏ –≤–µ–±-–¥–æ–¥–∞—Ç–∫—É). –ó—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –±–µ—Ä—É—Ç—å—Å—è `status`, `minutes_late`, `scheduled_start`, `actual_start`, `project`, `control_manager`.

2. **–ö–∞—Ç–µ–≥–æ—Ä—ñ—ó:**

   - **Late**: —Ä—è–¥–æ–∫ –∑—ñ —Å—Ç–∞—Ç—É—Å–æ–º `late`
   - **Absent**: —Å—Ç–∞—Ç—É—Å `absent`
   - **–Ü–Ω—à—ñ** (`present`, `leave`) —É –∑–≤—ñ—Ç –Ω–µ –≤—Ö–æ–¥—è—Ç—å

3. **–§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è:**
   - –ü—Ä–∏ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ `TELEGRAM_MANAGER_MAPPING` –±–æ—Ç –ø–æ–∫–∞–∑—É—î –ª–∏—à–µ —Ç–∏—Ö —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤, —É –∫–æ–≥–æ `control_manager` –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑—ñ —Å–ø–∏—Å–∫–æ–º —á–∞—Ç—É.

## –ë–µ–∑–ø–µ–∫–∞

- üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —Ç—ñ–ª—å–∫–∏ –¥–ª—è chat_id –∑—ñ —Å–ø–∏—Å–∫—É `TELEGRAM_ADMIN_CHAT_IDS`
- üö´ –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –æ—Ç—Ä–∏–º—É—é—Ç—å "Access denied"
- üìù –í—Å—ñ —Å–ø—Ä–æ–±–∏ –¥–æ—Å—Ç—É–ø—É –ª–æ–≥—É—é—Ç—å—Å—è

**Dev —Ä–µ–∂–∏–º:** –Ø–∫—â–æ `TELEGRAM_ADMIN_CHAT_IDS` –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ, –±–æ—Ç –¥–æ–∑–≤–æ–ª—è—î –≤—Å—ñ–º (—Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏!)

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

–í—Å—ñ –ø–æ–¥—ñ—ó –ª–æ–≥—É—é—Ç—å—Å—è:

- –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è –∑–≤—ñ—Ç—ñ–≤ (—É—Å–ø—ñ—Ö/–ø–æ–º–∏–ª–∫–∞)
- –í–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–º–∞–Ω–¥
- –°–ø—Ä–æ–±–∏ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
- –ü–æ–º–∏–ª–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–≤—ñ—Ç—ñ–≤

–§–æ—Ä–º–∞—Ç: `%(asctime)s - %(name)s - %(levelname)s - %(message)s`

## Troubleshooting

**–ë–æ—Ç –Ω–µ —Å—Ç–∞—Ä—Ç—É—î:**

- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `TELEGRAM_BOT_TOKEN` –≤ `.env`
- –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è —â–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —á–µ—Ä–µ–∑ [@BotFather](https://t.me/botfather)

**–ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç—å –∑–≤—ñ—Ç–∏:**

- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ `TELEGRAM_ADMIN_CHAT_IDS`
- –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –ª–æ–≥–∏ `scripts/run_attendance_bot.py`
- –£–ø–µ–≤–Ω—ñ—Ç—å—Å—è, —â–æ –ë–î `attendance_records` –º—ñ—Å—Ç–∏—Ç—å –¥–∞–Ω—ñ –∑–∞ –ø–æ—Ç–æ—á–Ω—É –¥–∞—Ç—É

**"Access denied":**

- –î–æ–¥–∞–π—Ç–µ –≤–∞—à Chat ID –≤ `TELEGRAM_ADMIN_CHAT_IDS` (—á–µ—Ä–µ–∑ –∫–æ–º—É)
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç—ñ—Ç—å –±–æ—Ç–∞ –ø—ñ—Å–ª—è –∑–º—ñ–Ω–∏ `.env`

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —á–∞—Å –∑–≤—ñ—Ç—ñ–≤:**

- –ó–≤—ñ—Ç–∏ –Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –æ 09:20 **–í–∞—Ä—à–∞–≤—Å—å–∫–æ–≥–æ —á–∞—Å—É** (–¥–∏–≤. —Ç–∞–±–ª–∏—Ü—é —Ä–æ–∑–∫–ª–∞–¥—É –≤ `docs/AUTOMATION_OVERVIEW.md`)
- –ß–∞—Å –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π –≤ `AttendanceScheduler.REPORT_TIME`
- –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ timezone —Å–µ—Ä–≤–µ—Ä–∞: `date` (Linux/Mac) –∞–±–æ `Get-Date` (Windows)

## –†–æ–∑—Ä–æ–±–∫–∞

**–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –≤—Ä—É—á–Ω—É:**

```bash
# –û—Ç—Ä–∏–º–∞—Ç–∏ –∑–≤—ñ—Ç –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ
/report_today

# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å
/status
```

**–ú–æ–¥–∏—Ñ—ñ–∫–∞—Ü—ñ—è —á–∞—Å—É –∑–≤—ñ—Ç—ñ–≤:**
–í—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ –≤ `tracker_alert/bot/scheduler.py`:

```python
REPORT_TIME = time(9, 20)  # –ì–æ–¥–∏–Ω–∞, —Ö–≤–∏–ª–∏–Ω–∞ (Warsaw)
REPORT_TIMEZONE = "Europe/Warsaw"
```

**–î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –∫–æ–º–∞–Ω–¥:**

1. –î–æ–¥–∞–π—Ç–µ handler –≤ `bot/handlers/commands.py`
2. –ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ –≤ `AttendanceBot.build_application()`

## –ê–≤—Ç–æ—Ä

YaWare Bot Project - Attendance Monitoring System
